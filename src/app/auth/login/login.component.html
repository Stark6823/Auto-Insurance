// login.component.html
<div class="main-container">
  <!-- Left sidebar with decorative elements -->
  <div class="sidebar">
    <div class="sidebar-content">
      <h2 class="welcome-text">Welcome Back!</h2>
      <p class="welcome-subtext">We're glad to see you again. Access your account and continue your journey.</p>
    </div>
    <!-- Animated background shapes -->
    <div class="shapes">
      <div class="shape shape-1"></div>
      <div class="shape shape-2"></div>
      <div class="shape shape-3"></div>
    </div>
  </div>
  
  <!-- Right content area with forms -->
  <div class="content">
    <!-- Login Form -->
    <div class="form-container" *ngIf="!forgotPasswordFlag && !otpVerificationFlag">
      <div class="form-header">
        <h1>Sign In</h1>
        <p>Enter your credentials to access your account</p>
      </div>

      <form #loginForm="ngForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-group">
            
            <input 
              type="email" 
              id="email" 
              class="form-control" 
              [(ngModel)]="email" 
              name="email" 
              placeholder="your@email.com" 
              required
              #emailInput="ngModel"
              [class.error]="emailInput.invalid && emailInput.touched"
            >
            <i class="input-icon fas fa-envelope"></i>
          </div>
          <small class="error-message" *ngIf="emailInput.invalid && emailInput.touched">
            Please enter a valid email address
          </small>
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <div class="input-group">
            
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              id="password" 
              class="form-control" 
              [(ngModel)]="password" 
              name="password" 
              placeholder="Enter your password" 
              required
              #passwordInput="ngModel"
              [class.error]="passwordInput.invalid && passwordInput.touched"
            >
            <i class="input-icon fas fa-lock"></i>
            <i 
              class="toggle-password" 
              
              (click)="togglePasswordVisibility()"
            ></i>
          </div>
          <small class="error-message" *ngIf="passwordInput.invalid && passwordInput.touched">
            Password is required
          </small>
        </div>
        
        <button 
          type="submit" 
          class="btn-submit" 
          [disabled]="loginForm.invalid || isLoading"
        >
          <span *ngIf="!isLoading">Sign In</span>
          <div class="spinner" *ngIf="isLoading"></div>
        </button>
        
        <div class="form-footer">
          <p><a (click)="forgotPassword()" class="text-link">Forgot your password?</a></p>
          <p>Don't have an account? <a (click)="goTORegister()" class="text-link">Create account</a></p>
        </div>
      </form>
    </div>
    
    <!-- Forgot Password Form -->
    <div class="form-container" *ngIf="forgotPasswordFlag && !otpVerificationFlag">
      <div class="form-header">
        <h1>Reset Password</h1>
        <p>Enter your new password to reset</p>
      </div>

      <form #resetForm="ngForm" (ngSubmit)="sendPasswordResetOTP()">
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-group">
            
            <input 
              type="email" 
              id="reset-email" 
              class="form-control" 
              [(ngModel)]="email" 
              name="email" 
              placeholder="your@email.com" 
              required
              #resetEmailInput="ngModel"
              [class.error]="resetEmailInput.invalid && resetEmailInput.touched"
            >
            <i class="input-icon fas fa-envelope"></i>
          </div>
          <small class="error-message" *ngIf="resetEmailInput.invalid && resetEmailInput.touched">
            Please enter a valid email address
          </small>
        </div>
        
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <div class="input-group">
            
            <input 
              [type]="showNewPassword ? 'text' : 'password'" 
              id="newPassword" 
              class="form-control" 
              [(ngModel)]="newPassword" 
              name="newPassword" 
              placeholder="Enter new password" 
              required
              #newPasswordInput="ngModel"
              [class.error]="newPasswordInput.invalid && newPasswordInput.touched"
            >
            <i class="input-icon fas fa-lock"></i>
            <i 
              class="toggle-password" 
              (click)="toggleNewPasswordVisibility()"
            ></i>
          </div>
          <small class="error-message" *ngIf="newPasswordInput.invalid && newPasswordInput.touched">
            New password is required
          </small>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="input-group">
            
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              id="confirmPassword" 
              class="form-control" 
              [(ngModel)]="reenterPassword" 
              name="reenterPassword" 
              placeholder="Confirm your password" 
              required
              #confirmPasswordInput="ngModel"
              [class.error]="confirmPasswordInput.invalid && confirmPasswordInput.touched || passwordsDoNotMatch"
            >
            <i class="input-icon fas fa-lock"></i>
            <i 
              class="toggle-password" 
              (click)="toggleConfirmPasswordVisibility()"
            ></i>
          </div>
          <small class="error-message" *ngIf="confirmPasswordInput.invalid && confirmPasswordInput.touched">
            Please confirm your password
          </small>
          <small class="error-message" *ngIf="passwordsDoNotMatch">
            Passwords do not match
          </small>
        </div>
        
        <button 
          type="submit" 
          class="btn-submit" 
          [disabled]="resetForm.invalid || isOtpLoading || passwordsDoNotMatch"
        >
          <span *ngIf="!isOtpLoading">Send OTP</span>
          <div class="spinner" *ngIf="isOtpLoading"></div>
        </button>
        
        <div class="form-footer">
          <p><a (click)="cancelReset()" class="text-link">Back to login</a></p>
        </div>
      </form>
    </div>
    
    <!-- OTP Verification Form -->
    <div class="form-container" *ngIf="otpVerificationFlag">
      <div class="form-header">
        <h1>Verify OTP</h1>
        <p>Enter the OTP sent to your email</p>
      </div>

      <form #otpForm="ngForm" (ngSubmit)="verifyAndResetPassword()">
        <div class="form-group otp-group">
          <label for="otp">One-Time Password</label>
          <div class="input-group">
            
            <input 
              type="text" 
              id="otp" 
              class="form-control" 
              [(ngModel)]="otp" 
              name="otp" 
              placeholder="Enter OTP" 
              required
              maxlength="6"
              #otpInput="ngModel"
              [class.error]="otpInput.invalid && otpInput.touched"
            >
            <i class="input-icon fas fa-key"></i>
          </div>
          <small class="error-message" *ngIf="otpInput.invalid && otpInput.touched">
            OTP is required
          </small>
          
          <div class="otp-timer" *ngIf="otpTimer > 0">
            Resend OTP in {{otpTimer}} seconds
          </div>
          <div class="otp-resend" *ngIf="otpTimer === 0">
            <a (click)="resendOTP()" class="text-link">Resend OTP</a>
          </div>
        </div>
        
        <button 
          type="submit" 
          class="btn-submit" 
          [disabled]="otpForm.invalid || isVerifying"
        >
          <span *ngIf="!isVerifying">Verify & Reset Password</span>
          <div class="spinner" *ngIf="isVerifying"></div>
        </button>
        
        <div class="form-footer">
          <p><a (click)="cancelReset()" class="text-link">Back to login</a></p>
        </div>
      </form>
    </div>
    
    <!-- Toast notification -->
    <div class="toast" [class.visible]="toastVisible" [class.success]="toastType === 'success'" [class.error]="toastType === 'error'">
      <div class="toast-content">
        <i class="toast-icon" [class.bi-check-circle]="toastType === 'success'" [class.bi-exclamation-circle]="toastType === 'error'"></i>
        <span>{{toastMessage}}</span>
      </div>
      <div class="toast-progress" [style.animation-duration]="toastDuration + 'ms'"></div>
    </div>
  </div>
</div>
